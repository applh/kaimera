# Text3D App Documentation

## Overview
Text3D is a creative tool that generates 3D volumetric text. It allows users to input custom text, adjust its color and extrusion depth, and view it in 3D space. It is built using the LibGDX framework integrated into the Kaimera Android app.

## Architecture

The app runs within a standard Android Activity (`Text3DActivity`) that hosts a LibGDX `Game` instance.

### Package Structure
- `com.example.kaimera.text3d`:
  - `Text3DActivity`: Android entry point. Manages UI overlay (Settings dialog, FABs) and specific Android API interactions (like Fonts).
  - `Text3DGame`: Main LibGDX `Game` class responsible for 3D rendering and camera control.
  - `Text3DMeshGenerator`: **Core Logic**. Generates the 3D geometry from text strings.
  - `earcut`: Contains the embedded optimization algorithms.
    - `Earcut.java`: Robust polygon triangulation library (embedded source).

## Key Features
- **True 3D Geometry**: Generates actual 3D meshes with front faces, back faces, and side walls.
- **Complex Glyph Support**: Correctly handles letters with holes (e.g., "O", "A", "B", "&") using advanced polygon triangulation.
- **Customizable Appearance**:
  - **Extrusion Depth**: Adjustable thickness.
  - **Colors**: Separate control for Face Color, Side/Wall Color, and Back Color.
- **Interactive Camera**: Orbital camera controls (pan, rotate) to view text from any angle.

## Technical Implementation

### True 3D Mesh Generation
Unlike earlier versions that used "Layer Stacking" (drawing the text multiple times at different depths), the current implementation generates a single, solid 3D mesh. This provides better performance for rendering and eliminates visual artifacts like "ridges" on the sides.

#### 1. Contour Extraction (Android API)
The app uses Android's `PathMeasure` API to extract precise vector contours from any `Typeface` (font).
- The text is first rendered to a `Path`.
- `PathMeasure` iterates through the path to extract points.
- Curves are flattened into line segments based on a resolution step (`textSize / 20f`).

#### 2. Hole Detection & Grouping
A critical challenge in 3D text is handling "holes" (e.g., the inside of an 'O').
- The generator groups contours into **Polygons**.
- A Polygon consists of one **Outer** contour and zero or more **Hole** contours.
- This grouping ensures that when the mesh is generated, the holes are correctly subtracted from the solid shape.

#### 3. Triangulation (Earcut)
To convert the complicated 2D font outlines into renderable triangles, we use the **Earcut** algorithm.
- **Library**: We use an embedded Java port of the industry-standard `earcut` library (originally by Mapbox).
- **Why Embedded?**: The source code is included directly (`earcut/Earcut.java`) to ensure stability and avoid build dependency issues on Android.
- **Process**: The outer contour and its holes are passed to `Earcut.earcut()`, which returns a list of triangle indices.

#### 4. mesh Construction
The final mesh is constructed in three parts:
- **Front Face**: Triangulated using Earcut (z = 0).
- **Back Face**: Triangulated using Earcut (z = -depth), with vertex winding reversed.
- **Side Walls**: Generated by "stitching" the edges of the outer and hole contours between the front and back faces.

### Code Example (Simplified)
```kotlin
// Text3DMeshGenerator.kt
val path = Path()
paint.getTextPath(text, ..., path)

// 1. Get Contours
val contours = extractContours(path)

// 2. Group into Polygons (Outer + Holes)
val polygons = groupContours(contours)

for (poly in polygons) {
    // 3. Triangulate Face (handles holes)
    val indices = Earcut.earcut(poly.vertices, poly.holeIndices, 2)
    
    // 4. Build Mesh
    addFace(indices, z=0)      // Front
    addFace(indices, z=-depth) // Back
    addWalls(poly)             // Sides
}
```

## Limitations
- **Generation Time**: Generating the mesh for very long strings or extremely complex fonts happens on the CPU and may take a few milliseconds.
- **Mobile Fonts**: relies on Android's `Typeface` API, so it uses the fonts available to the Android system.
